<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:Mobile.ViewModels"
             x:Class="Mobile.Views.BarcodeScannerPage"
             x:DataType="vm:BarcodeScannerViewModel"
             Title="{Binding Title}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Camera Placeholder -->
        <Frame Grid.Row="0" BackgroundColor="Black" HasShadow="False">
            <Grid>
                <!-- Default Camera View -->
                <StackLayout VerticalOptions="Center" 
                            HorizontalOptions="Center"
                            IsVisible="{Binding !IsDetecting}">
                    <Label Text="ðŸ“·" FontSize="72" TextColor="White" HorizontalOptions="Center" />
                    <Label Text="Camera View" TextColor="White" FontSize="16" HorizontalOptions="Center" />
                    <Label Text="Tap 'Start Scanning' to begin" TextColor="Gray" FontSize="12" HorizontalOptions="Center" />
                </StackLayout>

                <!-- Scanning View -->
                <Grid IsVisible="{Binding IsDetecting}">
                    <StackLayout VerticalOptions="Center" HorizontalOptions="Center">
                        <Label Text="ðŸ”" FontSize="72" TextColor="Lime" HorizontalOptions="Center" />
                        <Label Text="Scanning for barcodes..." TextColor="White" FontSize="16" HorizontalOptions="Center" />
                        <ActivityIndicator IsRunning="{Binding IsDetecting}" 
                                         Color="Lime" 
                                         VerticalOptions="Center"
                                         Margin="0,10,0,0"/>
                    </StackLayout>
                    
                    <!-- Scanning Frame Overlay -->
                    <Frame BackgroundColor="Transparent"
                           BorderColor="Lime"
                           HasShadow="False"
                           WidthRequest="200"
                           HeightRequest="100"
                           HorizontalOptions="Center"
                           VerticalOptions="Center">
                        <Label Text="Position barcode here" 
                               TextColor="White" 
                               FontSize="12" 
                               HorizontalOptions="Center"
                               VerticalOptions="Center"/>
                    </Frame>
                </Grid>

                <!-- Scan Result Overlay -->
                <Frame IsVisible="{Binding HasValidProduct}"
                       BackgroundColor="#CC000000"
                       BorderColor="Transparent"
                       HasShadow="False"
                       VerticalOptions="End"
                       Margin="10">
                    <StackLayout Spacing="5">
                        <Label Text="âœ… Product Found!" 
                               TextColor="LimeGreen" 
                               FontSize="16" 
                               FontAttributes="Bold"/>
                        <Label Text="{Binding ScannedBarcode}" 
                               TextColor="White" 
                               FontSize="12" 
                               FontFamily="Courier"/>
                        <Label Text="{Binding ProductInfo}" 
                               TextColor="LightGray" 
                               FontSize="12"/>
                    </StackLayout>
                </Frame>
            </Grid>
        </Frame>

        <!-- Product Information and Scanner Status -->
        <Grid Grid.Row="1" Padding="15" BackgroundColor="LightGray">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- Scanner Status -->
            <StackLayout Grid.Row="0" Orientation="Horizontal" Spacing="10" Margin="0,0,0,8">
                <Label Text="Status:" FontSize="12" FontAttributes="Bold" VerticalOptions="Center"/>
                <Label Text="{Binding ScannerStatus}" 
                       FontSize="12" 
                       TextColor="DarkBlue" 
                       VerticalOptions="Center"/>
                <ActivityIndicator IsRunning="{Binding IsContinuousScanning}" 
                                 Color="Blue" 
                                 WidthRequest="16" 
                                 HeightRequest="16"
                                 VerticalOptions="Center"/>
            </StackLayout>

            <!-- Scanned Barcode -->
            <Label Grid.Row="1"
                   Text="{Binding ScannedBarcode, StringFormat='Barcode: {0}'}"
                   FontSize="14"
                   FontAttributes="Bold"
                   FontFamily="Courier"
                   IsVisible="{Binding ScannedBarcode, Converter={StaticResource IsNotNullConverter}}" />

            <!-- Product Information -->
            <Label Grid.Row="2"
                   Text="{Binding ProductInfo}"
                   FontSize="12"
                   TextColor="DarkBlue"
                   IsVisible="{Binding ProductInfo, Converter={StaticResource IsNotNullConverter}}" />
        </Grid>

        <!-- Controls -->
        <Grid Grid.Row="2" Padding="15" BackgroundColor="DarkGray">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Button Grid.Column="0"
                    Text="{Binding IsDetecting, Converter={StaticResource BoolToTextConverter}, ConverterParameter='Stop Scanning|Start Scanning'}"
                    Command="{Binding ToggleDetectionCommand}"
                    BackgroundColor="{Binding IsDetecting, Converter={StaticResource BoolToColorConverter}, ConverterParameter='Orange|Green'}"
                    TextColor="White"
                    Margin="0,0,5,0" />

            <Button Grid.Column="1"
                    Text="Manual Entry"
                    Command="{Binding ManualEntryCommand}"
                    BackgroundColor="DodgerBlue"
                    TextColor="White"
                    Margin="2.5,0" />

            <Button Grid.Column="2"
                    Text="{Binding HasValidProduct, Converter={StaticResource BoolToTextConverter}, ConverterParameter='Add to Sale|Back'}"
                    Command="{Binding HasValidProduct, Converter={StaticResource BoolToTextConverter}, ConverterParameter='{Binding AddToSaleCommand}|{Binding BackCommand}'}"
                    BackgroundColor="{Binding HasValidProduct, Converter={StaticResource BoolToColorConverter}, ConverterParameter='LimeGreen|Gray'}"
                    TextColor="White"
                    Clicked="{Binding HasValidProduct, Converter={StaticResource BoolToTextConverter}, ConverterParameter='OnAddToSaleClicked|OnBackClicked'}"
                    Margin="5,0,0,0" />
        </Grid>

        <!-- Error Message -->
        <Label Grid.Row="0"
               Text="{Binding ErrorMessage}"
               TextColor="Red"
               FontSize="14"
               BackgroundColor="Black"
               Padding="10"
               HorizontalOptions="Center"
               VerticalOptions="End"
               IsVisible="{Binding HasError}"
               Margin="20" />
    </Grid>
</ContentPage>